#textdomain wesnoth-low
[scenario]
    id=08_Caverns_of_Saurgath
    next_scenario=08_Caverns_of_Saurgath2
    name= _ "Caverns of Saurgath2"
    {LOW_MAP 08_Caverns_of_Saurgath2.map}
    victory_when_enemies_defeated=no
    carryover_percentage=40
    carryover_add=yes
    {UNDERGROUND}
    {TURNS 53 48 43}

    {SCENARIO_MUSIC       the_deep_path.ogg}
    {EXTRA_SCENARIO_MUSIC knalgan_theme.ogg}
    {EXTRA_SCENARIO_MUSIC   underground.ogg}
    {EXTRA_SCENARIO_MUSIC      suspence.ogg}

    [side]
        side=1
        {SIDE_1_ESSENTIALS}
        {KALENZ}
        {SIDE_1_GOLD_FIXED 120 85}
        income=-2
        village_gold=1
        fog=no
        shroud=yes
#ifndef MULTIPLAYER
        [unit]
            {LANDAR_YOUNG}
            placement=leader
        [/unit]
#endif
    [/side]

    [side]
        side=2
        {SIDE_2_ESSENTIALS}
        gold=85
        {LANDAR}
        income=-2
        village_gold=1
        fog=no
        shroud=yes
    [/side]

    #Outpost guard:

    [side]
        side=3
        {UNPLAYABLE_SIDE}
        team_name=saurians
        user_team_name= _ "Enemies"
        {FLAG_VARIANT undead}
        {GOLD 0 10 15}
        {INCOME 2 4 6}
        type=Saurian Seer 
        id=Gil-Ja 
        name=_ "Gil-Ja"
#ifdef EASY 
        recruit=Giant Scorpling, Giant Ant
#endif
#ifdef NORMAL
        recruit=Giant Scorpling, Giant Ant, Giant Scorpion, Soldier Ant
#endif
#ifdef HARD
        recruit=Giant Scorpling, Giant Ant, Giant Scorpion, Soldier Ant, Firebane Ant, Firebomb Ant, Giant Spider
#endif
        [ai]
            passive_leader=yes 
        [/ai]
    [/side]

    [side]
        side=4
        {UNPLAYABLE_SIDE}
        team_name=saurians
        user_team_name= _ "Enemies"
        {FLAG_VARIANT undead}
        no_leader=yes
    [/side]

    {STARTING_VILLAGES_ALL 3}

    [event]
    name=prestart 

        {PLACE_IMAGE "units/monsters/cat/tritail-sitting.png~BLIT(items/cage.png)" 18 20}
        {PLACE_IMAGE "units/monsters/cat/jumpcat.png~BLIT(items/cage.png)" 28 20}

        #enter guard 
        {LOYAL_UNIT 3 "Saurian Ambusher" 7 41}{GUARDIAN}
        {LOYAL_UNIT 3 "Saurian Ambusher" 8 42}{GUARDIAN}
        {LOYAL_UNIT 3 "Saurian Oracle" 7 42}{GUARDIAN}

        {MODIFY_UNIT side=3 facing sw}

        [unit]
            {ERLORNAS}
            placement=leader
        [/unit]

        [unit]
            {CLEODIL_COMPANION}
            placement=leader
        [/unit]

        [hide_unit]
            side=1,2 
        [/hide_unit]
    [/event]

    [event]
    name=start 

        [unhide_unit]
            id=Erlornas
        [/unhide_unit]

        {MOVE_UNIT id=Erlornas 5 44}

        [unhide_unit]
            id=Kalenz
        [/unhide_unit]

        {MOVE_UNIT id=Kalenz 5 44}

        [unhide_unit]
            id=Landar
        [/unhide_unit]

        {MOVE_UNIT id=Landar 5 44}

        [unhide_unit]
            id=Cleodil
        [/unhide_unit]

        {MOVE_UNIT id=Cleodil 5 44}

        [redraw][/redraw]

        [message]
            speaker=Landar 
            message= _ "The lizards are chasing us!"
        [/message]
        [message]
            speaker=Cleodil
            message= _ "I will command the roots to seal the passage!"
        [/message]

        [animate_unit]
            flag=healing
            [filter]
                id=Cleodil 
            [/filter]
            [facing]
                x,y=5,48
            [/facing]
        [/animate_unit]

        {QUAKE "cave-in.ogg"}

        [terrain]
            x,y,radius=5,48,1
            terrain=Xue
        [/terrain]

        [redraw][/redraw]

        [animate_unit]
            flag=healing
            [filter]
                id=Cleodil 
            [/filter]
            [facing]
                x,y=5,48
            [/facing]
        [/animate_unit]

        {QUAKE "entangle.wav"}

        [terrain]
            x,y,radius=5,48,1
            terrain=Xuf
        [/terrain]
        [redraw][/redraw]

        [message]
            speaker=Kalenz 
            message= _ "Excellent, Cleodil, you've bought us time!"
        [/message]
        [message]
            type=Saurian Oracle
            message= _ "Elves! Elves in the caves! I will call Master Gil-Ja!"
        [/message]

        {MOVE_UNIT type="Saurian Oracle" 12 11}

        [message]
            speaker=Erlornas 
            message= _ "There's a lizard outpost ahead, we need to capture it."
        [/message]
        
        [objectives]
            side=0
            [objective]
                caption= _ "Your first task:"
                description= _ "Defeat the outpost guardians"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Kalenz"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Landar"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Cleodil"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Erlornas"
                condition=lose
            [/objective]
            {TURNS_RUN_OUT}
            [gold_carryover]
                carryover_percentage=40
                bonus=yes
            [/gold_carryover]
        [/objectives]
    [/event]
    [event]
    name=die 
    first_time_only=no 

        [filter]
            type=Saurian Ambusher 
        [/filter]
        [filter_condition]
            [not]
                [have_unit]
                    type=Saurian Ambusher 
                [/have_unit]
            [/not]
        [/filter_condition]

        [message]
            speaker=Kalenz
            message= _ "The outpost is ours!"
        [/message]
        [message]
            speaker=Erlornas
            message= _ "You act boldly and swiftly, Kalenz. Few would have dared to follow me into the lizard capital, and even fewer would have reached the caves alive."
        [/message]
        [message]
            speaker=Kalenz
            message= _ "There is a reason for that, milord. I did it because I am in desperate need of your help against the orcs."
        [/message]
        [message]
            speaker=Erlornas
            message= _ "Yes, Cleodil told me. I will help you, but know that more is at stake than just your home. The orcs threaten our entire people. We face a brutal struggle for survival."
        [/message]
        [message]
            speaker=Kalenz
            message= _ "I have felt that since the first day of the war."
        [/message]
        [message]
            speaker=Landar
            message= _ "We are ready for the fight, milord. Under your banner, we will exterminate the filthy orcs!"
        [/message]
        [message]
            speaker=Erlornas
            message= _ "Your spirit will be a support for the warriors, Landar. But enough talk; only the underground swamp separates us from the exit."
        [/message]

        [objectives]
            side=0
            [objective]
                caption= _ "Final task:"
                description= _ "Move Kalenz or Landar to the northern map border"
                condition=win
            [/objective]
            [objective]
                description= _ "Death of Kalenz"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Landar"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Cleodil"
                condition=lose
            [/objective]
            [objective]
                description= _ "Death of Erlornas"
                condition=lose
            [/objective]
            {TURNS_RUN_OUT}
            [gold_carryover]
                carryover_percentage=40
                bonus=yes
            [/gold_carryover]
        [/objectives]
    [/event]

    [event]
        name=enter hex 

        [filter]
            side=1
            [filter_location]
                terrain=Ss
            [/filter_location]
        [/filter]

        [message]
            speaker=Cleodil
            message= _ "The swamp is seething with malice. I have a bad feeling."
        [/message]

        [remove_shroud]
            side=1,2 
            terrain=Ss 
        [/remove_shroud]
        [remove_shroud]
            x,y,radius=23,21,1
        [/remove_shroud]
        [redraw][/redraw]

        {TELEPORT_UNIT id=Gil-Ja 23 21}
        {TELEPORT_UNIT type="Saurian Oracle" 22 20}
        {MODIFY_UNIT id=Gil-Ja facing s}
        {MODIFY_UNIT type="Saurian Oracle" facing s}

        [message]
            speaker=Gil-Ja 
            message= _ "You've gone mad from torture, elf lord! Why run here? To sacrifice your squad to this sorcerous swamp? Come on then! The swamp will gladly devour you!"
        [/message]
        [message]
            speaker=Erlornas
            message= _ "Beware, mockery won't help you when we meet face to face."
        [/message]
        [message]
            speaker=Gil-Ja 
            message= _ "Your face will meet only black mud! The mud will flood your eyes, nostrils, fill your throat and insides! Rise, my slaves!"
        [/message]

        {FLASH_RED (
        [sound]
        name="magic-dark-big.ogg"
        [/sound])}


        {SCATTER_UNITS 15 "Giant Mudcrawler" 3 (
            terrain=Ss
            [and]
                [not]
                	[filter]
                	[/filter]
                [/not]
                [not]
                    [filter_adjacent_location]
                        [filter]
                        [/filter]
                    [/filter_adjacent_location]
                [/not]
            [/and]
        ) (
            side=3
            ai_special=guardian
            animate=yes
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        )}
        {SCATTER_UNITS 15 "Mudcrawler" 2 (
            terrain=Ss
            [and]
                [not]
                	[filter]
                	[/filter]
                [/not]
                [not]
                    [filter_adjacent_location]
                        [filter]
                        [/filter]
                    [/filter_adjacent_location]
                [/not]
            [/and]
        ) (
            side=3
            ai_special=guardian
            animate=yes
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        )}

        [message]
            speaker=Gil-Ja 
            message= _ "This is what you will become!"
        [/message]

        {MOVE_UNIT id=Gil-Ja 11 10}
        {MOVE_UNIT type="Saurian Oracle" 12 11}
        {MODIFY_UNIT id=Gil-Ja facing s}
        {MODIFY_UNIT type="Saurian Oracle" facing s}

        [message]
            speaker=Landar
            message= _ "How do we get through this hell?!"
        [/message]
        [message]
            speaker=Erlornas
            message= _ "Be brave, these creatures are stupid and slow. Fight shoulder to shoulder, cover the wounded, and we will get out!"
        [/message]

        [event]
        name=sighted

            [filter]
                id=Gil-Ja
            [/filter]
            [filter_second]
                side=1,2 
            [/filter_second]

            [message]
                speaker=Gil-Ja 
                message= _ "What?! How is this possible?!"
            [/message]
            [message]
                speaker=Erlornas
                message= _ "You are a fool to hope you could stop elven warriors with mud. Prepare to meet your fate!"
            [/message]
            [message]
                speaker=Gil-Ja 
                message= _ "The battle isn't over yet! It is you who should prepare... Yes, I swear, you will never see sunlight again!"
            [/message]

            {MOVE_UNIT id=Gil-Ja 13 1}
            [kill]
                id=Gil-Ja 
                animate=no 
            [/kill]
            {MOVE_UNIT type="Saurian Oracle" 13 1}

            [micro_ai]
                side=3
                ai_type=stationed_guardian
                action=add

                [filter]
                    type=Saurian Oracle
                [/filter]
                distance=0
                station_x,station_y=13,1
                guard_x,guard_y=13,1
            [/micro_ai]

            [message]
                speaker=Erlornas
                message= _ "The exit is already close, behind them!"
            [/message]
        [/event]
    [/event]

    [event]
    name=last breath

        [filter]
            type=Saurian Oracle 
        [/filter]

        [message]
            speaker=unit 
            message= _ "Master Gil-Ja, I'm dying for you!"
        [/message]
    [/event]

    #Jumpcat: 

    [event]
    name=open_jumpcat_cage 

        [sound]
            name=open-chest.wav 
        [/sound]

        {REMOVE_IMAGE 28 20}

        [unit]
            type=Jumpcat
            side=$unit.side 
            x,y=$unit.x,$unit.y
            passable=yes 
            animate=yes 
            gender=female
            [modifications]
                {TRAIT_STRONG}
                {TRAIT_QUICK}
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]

        [message]
            scroll=no
            speaker=Cleodil 
            message= _ "She longs for the moonlight so badly. In thanks for saving her, she promises to protect us from the shadows."
        [/message]

        [if]
            [have_unit]
                race=cats 
                count=2 
            [/have_unit]
        [then]
            [set_achievement]
                content_for=low 
                id=low_s8_cats
            [/set_achievement]
        [/then]
        [/if]
    [/event]

    [event]
    name=moveto 
    id=not_cleodil_finds_jumpcat 

        [filter]
            side=1,2
            [not]
                id=Cleodil 
            [/not]
            [not]
                race=cats 
            [/not]
            [filter_location]
                x,y=28,20
            [/filter_location]
        [/filter]

        [message]
            speaker=unit 
            male_message= _ "What be this odd creature? Never in my life have I seen such a beast."
            female_message= _ "female^What be this odd creature? Never in my life have I seen such a beast."
        [/message]

        [message]
            speaker=Cleodil
            message= _ "It's a Jump Cat! Even in forest dark and deep is such a beast rare indeed. We shall free her."
        [/message]

        [fire_event]
            name=kalenz_cares 
        [/fire_event]

        [remove_event]
            id=cleodil_finds_jumpcat
        [/remove_event]
        
        [fire_event]
            name=open_jumpcat_cage
            [primary_unit]
                find_in=unit 
            [/primary_unit]
        [/fire_event]
    [/event]

    [event]
    name=moveto 
    id=cleodil_finds_jumpcat

        [filter]
            id=Cleodil 
            [filter_location]
                x,y=28,20
            [/filter_location]
        [/filter]

        [message]
            speaker=Cleodil
            message= _ "Behold, tis a Jump Cat! Even in forest dark and deep is such a beast rare indeed. We shall free her."
        [/message]

        [fire_event]
            name=kalenz_cares 
        [/fire_event]

        [remove_event]
            id=not_cleodil_finds_jumpcat
        [/remove_event]

        [fire_event]
            name=open_jumpcat_cage
            [primary_unit]
                find_in=unit 
            [/primary_unit]
        [/fire_event]
    [/event]

    [event]
    name=open_lion_cage 

        [sound]
            name=open-chest.wav 
        [/sound]

        {REMOVE_IMAGE 18 20}

        [unit]
            type=Forest Lion 
            side=$unit.side 
            x,y=$unit.x,$unit.y
            passable=yes 
            animate=yes 
            [modifications]
                {TRAIT_STRONG}
                {TRAIT_RESILIENT}
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]

        [message]
            scroll=no
            speaker=Cleodil 
            message= _ "Poor creature... the wizard tortured it severely. It wants to join us and take revenge on lizards."
        [/message]

        [if]
            [have_unit]
                race=cats 
                count=2 
            [/have_unit]
        [then]
            [set_achievement]
                content_for=low 
                id=low_s8_cats
            [/set_achievement]
        [/then]
        [/if]
    [/event]

    [event]
    name=moveto 
    id=not_cleodil_finds_lion 

        [filter]
            side=1,2
            [not]
                id=Cleodil 
            [/not]
            [not]
                race=cats 
            [/not]
            [filter_location]
                x,y=18,20
            [/filter_location]
        [/filter]

        [message]
            speaker=unit 
            message= _ "Look! Wizard hold captive a lion of the forest!"
        [/message]

        [message]
            speaker=Cleodil
            message= _ "Let us free him!"
        [/message]

        [fire_event]
            name=kalenz_cares 
        [/fire_event]

        [remove_event]
            id=cleodil_finds_lion 
        [/remove_event]

        [fire_event]
            name=open_lion_cage
            [primary_unit]
                find_in=unit 
            [/primary_unit]
        [/fire_event]
    [/event]

    [event]
    name=moveto 
    id=cleodil_finds_lion 

        [filter]
            id=Cleodil 
            [filter_location]
                x,y=18,20
            [/filter_location]
        [/filter]

        [message]
            speaker=Cleodil
            message= _ "A lion of the forest! Let us free him!"
        [/message]

        [fire_event]
            name=kalenz_cares 
        [/fire_event]

        [remove_event]
            id=not_cleodil_finds_lion
        [/remove_event]

        [fire_event]
            name=open_lion_cage
            [primary_unit]
                find_in=unit 
            [/primary_unit]
        [/fire_event]
    [/event]

    [event]
    name=kalenz_cares 
        [message]
            speaker=Kalenz
            message= _ "Be careful, Cleodil, this beast is dangerous."
        [/message]
    [/event]

    [event]
    name=moveto

        [filter]
            side=1,2
            id=Kalenz,Landar
            [filter_location]
                y=1
            [/filter_location]
        [/filter]

        [endlevel]
            result=victory
#ifdef MULTIPLAYER
            bonus=0.5
#else
            bonus=yes
#endif
            {NEW_GOLD_CARRYOVER 40}
        [/endlevel]
    [/event]
    [event]
    name=die 
    first_time_only=no

        [filter]
            side=1,2 
            level=1 
            [filter_location]
                terrain=Ss 
            [/filter_location]
        [/filter]

        [kill]
            find_in=unit 
        [/kill]

        {UNIT 3 "Mudcrawler" $unit.x $unit.y (animate=yes
        name= _ "$unit.name"
        [modifications]
            {TRAIT_LOYAL}
        [/modifications])}
        [fire_event]
            name=first_transform 
            [primary_unit]
                find_in=unit 
            [/primary_unit]
        [/fire_event]
    [/event]
    [event]
    name=last breath

        [filter]
            side=1,2
            [not]
                id=Kalenz,Landar,Erlornas,Cleodil 
            [/not]
            [filter_location]
                terrain=Ss 
            [/filter_location]
        [/filter]

        [message]
            speaker=unit
            message= _ "Kalenz... help..."
        [/message]
    [/event]
    [event]
    name=die 
    first_time_only=no

        [filter]
            side=1,2
            [not]
                id=Kalenz,Landar,Erlornas,Cleodil 
            [/not]
            [filter_location]
                terrain=Ss 
            [/filter_location]
        [/filter]

        [kill]
            find_in=unit 
        [/kill]

        [sound]
            name=mud-glob.ogg
        [/sound]
        
        [switch]
            variable=unit.level 
            [case]
                value=1
                {UNIT 3 "Mudcrawler" $unit.x $unit.y (animate=yes
                name= _ "$unit.name"
                [modifications]
                    {TRAIT_LOYAL}
                [/modifications])}
                [fire_event]
                    name=first_transform 
                [/fire_event]
            [/case]
            [else]
                {UNIT 3 "Giant Mudcrawler" $unit.x $unit.y (animate=yes
                name= _ "$unit.name"
                [modifications]
                    {TRAIT_LOYAL}
                [/modifications])}
                [fire_event]
                    name=first_transform 
                [/fire_event]
            [/else]
        [/switch]
    [/event]
    [event]
        name=first_phrase 
        [message]
            speaker=unit
            message= _ "Kalenz... help..."
        [/message]
    [/event]

    [event]
        name=first_transform 

        [message]
            speaker=Cleodil
            message= _ "How awful! The swamp is turning fallen elves into mud monsters!"
        [/message]
        [message]
            speaker=Landar
            message= _ "That wicked sorcerer will pay dearly for this!"
        [/message]
    [/event]
    {~add-ons/Legacy_of_Wesmere/utils/deaths.cfg}
[/scenario]
#undef OPEN_LION_GATE
